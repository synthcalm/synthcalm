<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Mood Into Art</title>
    <link rel="stylesheet" href="/synthcalm/style.css"/>
    <style>
        #startVoice.recording {
            border-color: magenta;
            color: magenta;
        }

        #clear.active,
        #styleSelect.active,
        #generate.active,
        #saveMood.active,
        #synthCalmHome.active {
            border-color: yellow;
        }

        #generate.active {
            background-color: yellow;
            color: black;
        }

        #styleSelect:focus {
            outline: 2px solid yellow;
        }

        #generate:disabled {
            background-color: grey;
            cursor: not-allowed;
        }
    </style>
</head>
<body>
<div class="container">
    <p>1. Press the "Start Voice" button and say what you feel. You have 60 Seconds. 2. Choose an art style. 3. Generate Image.</p>

    <canvas id="waveform" aria-label="Waveform Visualization"></canvas>

    <div class="footer-bar">
        <div id="dateTimeDisplay" class="seven-segment"></div>
        <div id="countdownDisplay" class="seven-segment">00:60</div>
    </div>

    <textarea id="activityInput" rows="4" placeholder="Describe your mood... (editable after recording)" aria-label="Mood description"></textarea>

    <div class="button-group">
        <button class="button" id="startVoice" aria-label="Start voice recording">Start Voice</button>
        <button class="button" id="clear" aria-label="Clear input and image">Clear</button>
        <select id="styleSelect" aria-label="Choose art style">
            <option value="none" selected disabled>Choose Style</option>
            <option value="photo">Hyper-realistic Photo</option>
            <option value="anime">Japanese Anime Style</option>
            <option value="abstract">Abstract</option>
            <option value="surrealism">Surrealism</option>
            <option value="post-modern">Post-modern</option>
            <option value="cyberpunk">Cyberpunk</option>
            <option value="arabic-calligraphy">Arabic Calligraphy</option>
            <option value="chinese-calligraphy">Chinese Calligraphy</option>
            <option value="japanese-calligraphy">Japanese Calligraphy</option>
            <option value="marvel">Marvel Comic</option>
            <option value="art-deco">Art Deco</option>
            <option value="impressionist">Impressionist</option>
            <option value="pop-art">Pop Art</option>
            <option value="digital-painting">Digital Painting</option>
            <option value="minimalism">Minimalism</option>
        </select>
        <button class="button" id="generate" aria-label="Generate image">Generate Image</button>
        <button class="button" id="saveMood" aria-label="Save mood">Save</button>
        <button class="button" id="synthCalmHome" onclick="window.location.href='https://synthcalm.com'" aria-label="Go to SynthCalm Home">SynthCalm Home</button>
    </div>

    <hr style="border: none; border-top: 1px solid #0ff; margin: 20px 0;" />
    <p style="color:#0ff;font-size:14px;text-align:center;">Mood History</p>

    <div class="image-frame">
        <img id="generatedImage" style="display:none; max-width:100%;" alt="Generated Image" />
    </div>

    <div id="moodHistory" style="min-height: 100px;"></div>
    <div id="thinking" style="display:none;text-align:center;color:#ff0;font-family:'Courier New', monospace;">Generating...</div>
</div>

<script>
    // === Clock Display ===
    function updateDateTime() {
        const now = new Date();
        const formatted = now.toLocaleString(undefined, {
            timeZone: Intl.DateTimeFormat().resolvedOptions().timeZone,
            hour12: false
        });
        document.getElementById('dateTimeDisplay').textContent = formatted;
    }
    setInterval(updateDateTime, 1000);
    updateDateTime();

    // === Waveform Visualization and Voice Recording ===
    const canvas = document.getElementById("waveform");
    const ctx = canvas.getContext("2d");
    canvas.width = canvas.offsetWidth;
    canvas.height = 160;

    let analyser, dataArray, audioCtx, source, micStream;
    let recognition;
    const startBtn = document.getElementById("startVoice");
    const countdownDisplay = document.getElementById("countdownDisplay");
    let isRecording = false;
    let countdownInterval;

    function drawWaveform() {
        if (!analyser) {
            ctx.fillStyle = "black";
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            return;
        }
        requestAnimationFrame(drawWaveform);
        analyser.getByteTimeDomainData(dataArray);
        ctx.fillStyle = "black";
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        // Draw Grid Lines (Yellow)
        ctx.strokeStyle = "#ffff00";
        ctx.lineWidth = 0.5;

        // Vertical Grid Lines
        for (let i = canvas.width / 10; i < canvas.width; i += canvas.width / 10) {
            ctx.beginPath();
            ctx.moveTo(i, 0);
            ctx.lineTo(i, canvas.height);
            ctx.stroke();
        }

        // Horizontal Grid Lines
        for (let i = canvas.height / 4; i < canvas.height; i += canvas.height / 4) {
            ctx.beginPath();
            ctx.moveTo(0, i);
            ctx.lineTo(canvas.width, i);
            ctx.stroke();
        }

        // Draw Waveform (Yellow)
        ctx.strokeStyle = "#ffff00";
        ctx.lineWidth = 2;
        ctx.beginPath();
        const sliceWidth = canvas.width / dataArray.length;
        let x = 0;
        for (let i = 0; i < dataArray.length; i++) {
            const v = dataArray[i] / 128.0;
            const y = (v * canvas.height) / 2;
            if (i === 0) ctx.moveTo(x, y);
            else ctx.lineTo(x, y);
           
