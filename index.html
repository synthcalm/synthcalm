<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SynthCalm</title>
  <style>
    body {
      font-family: 'Courier New', monospace;
      margin: 0;
      background: #000;
      color: #0ff;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      flex-direction: column;
    }

    .container {
      width: 90%;
      max-width: 600px;
      padding: 20px;
      border: 2px solid #0ff;
      border-radius: 12px;
    }

    canvas#waveform {
      width: 100%;
      height: 160px;
      background-color: #000;
      border: 1px solid #0ff;
      background-image: linear-gradient(to right, rgba(255, 255, 0, 0.3) 1px, transparent 1px),
                        linear-gradient(to bottom, rgba(255, 255, 0, 0.3) 1px, transparent 1px);
      background-size: 20px 20px;
    }

    .footer-bar {
      display: flex;
      justify-content: space-between;
      font-size: 14px;
      margin: 10px 0;
    }

    textarea,
    .button,
    select#styleSelect {
      width: 100%;
      background: #000;
      border: 2px solid #0ff;
      color: #0ff;
      padding: 10px;
      margin-bottom: 10px;
      text-align: center;
      box-sizing: border-box;
      font-family: 'Courier New', monospace;
      font-size: 14px;
      text-transform: uppercase; /* Convert all text to uppercase */
    }

    /* Specific styles for textarea */
    textarea#activityInput {
      max-width: 100%;
      min-height: 60px;
      resize: none;
      overflow-wrap: break-word;
      font-size: 14px;
      text-transform: none; /* Keep textarea content as-is */
    }

    /* Styled dropdown to look like buttons */
    select#styleSelect {
      text-align: center;
      text-align-last: center;
      -webkit-text-align-last: center; /* Safari (iOS/iPad) */
      -moz-text-align-last: center;
      -webkit-appearance: none;
      -moz-appearance: none;
      appearance: none;
      background-position: right 10px center;
      background-repeat: no-repeat;
      padding-right: 30px;
      padding-left: 10px;
      line-height: normal;
      display: block;
      box-sizing: border-box;
      cursor: pointer;
    }

    /* Dropdown options style */
    select#styleSelect option {
      text-align: center;
      font-family: 'Courier New', monospace;
      font-size: 14px;
      background: #000;
      color: #0ff;
      text-transform: uppercase; /* Convert dropdown options to uppercase */
    }

    /* Hover effect for Choose Style dropdown */
    select#styleSelect:hover {
      background: #0ff;
      color: #000;
    }

    .button-group {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
    }

    .button {
      cursor: pointer;
    }

    .button.recording {
      background: #000 !important;
      border-color: #ff00ff !important;
      color: #0ff !important;
    }

    .button:hover {
      background: #0ff;
      color: #000;
    }

    .seven-segment {
      font-family: 'Courier New', monospace;
      font-size: 14px;
    }

    .image-frame {
      width: 100%;
      max-height: 400px;
      overflow: hidden;
      display: flex;
      justify-content: center;
      align-items: center;
      margin-top: 10px;
    }

    #generatedImage {
      max-width: 100%;
      max-height: 100%;
      object-fit: contain;
      display: none;
      border: 2px solid #0ff;
    }

    #thinking {
      font-family: 'Courier New', monospace;
      font-size: 14px;
      color: #ff0;
      text-align: center;
      margin-top: 5px;
      margin-bottom: 10px;
      height: 20px;
      display: none;
    }

    #moodHistory {
      margin-top: 10px;
      font-size: 13px;
      color: #0ff;
    }

    .history-entry {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 6px;
      gap: 8px;
    }

    .history-entry img {
      max-width: 100px;
      max-height: 100px;
      object-fit: contain;
    }

    .history-entry button {
      background: transparent;
      border: 1px solid #0ff;
      color: #0ff;
      padding: 2px 8px;
      cursor: pointer;
      font-size: 12px;
    }

    .history-entry button:hover {
      background: #0ff;
      color: #000;
    }

    /* Soft Blinking Yellow Border Effect */
    @keyframes soft-blink {
      0% { border-color: #0ff; } /* Default cyan border */
      50% { border-color: #ffff00; } /* Yellow */
      100% { border-color: #0ff; } /* Back to cyan */
    }

    select#styleSelect.blink-yellow,
    .button.blink-yellow {
      animation: soft-blink 1.5s infinite ease-in-out !important;
    }

    /* Solid Yellow Highlight (for Generate Image button and Generating dots) */
    .highlight-yellow {
      border-color: #ffff00 !important; /* Solid yellow border */
      color: #0ff; /* Keep text color cyan for buttons */
    }

    /* Apply yellow color to the Generating dots when highlighted */
    #thinking.highlight-yellow {
      color: #ffff00 !important; /* Yellow text for the dots */
    }
  </style>
</head>
<body>
  <div class="container">
    <canvas id="waveform"></canvas>
    <div class="footer-bar">
      <span class="seven-segment" id="currentTime"></span>
      <span class="seven-segment">00:60</span>
    </div>
    <textarea id="activityInput" readonly></textarea>
    <div class="button-group">
      <button id="startVoice" class="button">START VOICE</button>
      <button id="clear" class="button">CLEAR</button>
    </div>
    <div class="button-group">
      <select id="styleSelect">
        <option value="">CHOOSE STYLE</option>
        <option value="photo">PHOTO</option>
        <option value="anime">ANIME</option>
        <option value="abstract">ABSTRACT</option>
        <option value="surrealism">SURREALISM</option>
        <option value="post-modern">POST-MODERN</option>
        <option value="cyberpunk">CYBERPUNK</option>
        <option value="arabic-calligraphy">ARABIC CALLIGRAPHY</option>
        <option value="chinese-calligraphy">CHINESE CALLIGRAPHY</option>
        <option value="japanese-calligraphy">JAPANESE CALLIGRAPHY</option>
        <option value="marvel">MARVEL</option>
        <option value="art-deco">ART DECO</option>
        <option value="impressionist">IMPRESSIONIST</option>
        <option value="pop-art">POP ART</option>
        <option value="digital-painting">DIGITAL PAINTING</option>
        <option value="minimalism">MINIMALISM</option>
      </select>
      <button id="generateImage" class="button">GENERATE IMAGE</button>
    </div>
    <div class="button-group">
      <button id="save" class="button">SAVE</button>
      <button id="synthcalmHome" class="button">SYNTHCALM HOME</button>
    </div>
    <div id="thinking">GENERATING...</div>
    <div id="moodHistory">
      <h3>MOOD HISTORY</h3>
    </div>
  </div>

  <script>
    // Select DOM elements
    const startVoiceButton = document.getElementById('startVoice');
    const styleSelect = document.getElementById('styleSelect');
    const generateImageButton = document.getElementById('generateImage');
    const saveButton = document.getElementById('save');
    const clearButton = document.getElementById('clear');
    const synthcalmHomeButton = document.getElementById('synthcalmHome');
    const thinkingDots = document.getElementById('thinking');
    const activityInput = document.getElementById('activityInput');
    const currentTime = document.getElementById('currentTime');

    // State variables
    let isRecording = false;
    let selectedStyle = null;

    // Update current time display
    function updateTime() {
      const now = new Date();
      currentTime.textContent = now.toLocaleString('en-US', {
        year: 'numeric',
        month: 'numeric',
        day: 'numeric',
        hour: 'numeric',
        minute: '2-digit',
        second: '2-digit',
        hour12: true
      }).replace(',', '');
    }
    updateTime();
    setInterval(updateTime, 1000);

    // Start/Stop Voice button logic
    startVoiceButton.addEventListener('click', () => {
      if (!isRecording) {
        // Start recording
        startVoiceButton.textContent = 'STOP VOICE';
        startVoiceButton.classList.add('recording');
        isRecording = true;
        // Simulate voice recording (replace with actual voice recording logic)
        setTimeout(() => {
          activityInput.value = 'man when you think you just almost have it and then you know it breaks down after unbelievable image';
        }, 2000);
      } else {
        // Stop recording
        startVoiceButton.textContent = 'START VOICE';
        startVoiceButton.classList.remove('recording');
        isRecording = false;
        // Make the "Choose Style" dropdown blink
        console.log('Stop Voice clicked, adding blink-yellow to styleSelect');
        styleSelect.classList.add('blink-yellow');
      }
    });

    // Choose Style dropdown logic
    styleSelect.addEventListener('change', () => {
      selectedStyle = styleSelect.value;
      if (selectedStyle) {
        // Stop blinking on Choose Style
        console.log('Style selected:', selectedStyle, 'removing blink-yellow from styleSelect');
        styleSelect.classList.remove('blink-yellow');
        // Start blinking on Generate Image
        console.log('Adding blink-yellow to generateImageButton');
        generateImageButton.classList.add('blink-yellow');
      }
    });

    // Generate Image button logic
    generateImageButton.addEventListener('click', async () => {
      if (!activityInput.value || !selectedStyle) {
        alert('Please provide a prompt and select a style.');
        return;
      }

      // Stop blinking on Generate Image
      console.log('Generate Image clicked, removing blink-yellow from generateImageButton');
      generateImageButton.classList.remove('blink-yellow');
      // Highlight Generate Image and Generating dots in solid yellow
      generateImageButton.classList.add('highlight-yellow');
      thinkingDots.classList.add('highlight-yellow');
      thinkingDots.style.display = 'block'; // Show the "Generating..." dots

      try {
        // Send request to the server to generate the image
        const response = await fetch('/generate-image', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ prompt: activityInput.value, style: selectedStyle })
        });

        const data = await response.json();
        if (data.image) {
          // Add the image and voice script to Mood History
          const moodHistory = document.getElementById('moodHistory');
          const entry = document.createElement('div');
          entry.className = 'history-entry';
          const img = document.createElement('img');
          img.src = data.image;
          img.alt = 'Generated Image';
          const text = document.createElement('span');
          text.textContent = `${new Date().toISOString()}: ${activityInput.value}`;
          entry.appendChild(img);
          entry.appendChild(text);
          moodHistory.appendChild(entry);

          // Remove highlight from Generate Image and Generating dots
          generateImageButton.classList.remove('highlight-yellow');
          thinkingDots.classList.remove('highlight-yellow');
          thinkingDots.style.display = 'none'; // Hide the dots

          // Start blinking on Save button
          console.log('Image generated, adding blink-yellow to saveButton');
          saveButton.classList.add('blink-yellow');
        } else {
          throw new Error(data.error || 'No image returned');
        }
      } catch (error) {
        console.error('Error generating image:', error);
        alert('Failed to generate image: ' + error.message);
        // Reset states on error
        generateImageButton.classList.remove('highlight-yellow');
        thinkingDots.classList.remove('highlight-yellow');
        thinkingDots.style.display = 'none';
      }
    });

    // Save button logic
    saveButton.addEventListener('click', () => {
      // Log the voice script and thumbnail (already added to Mood History)
      console.log('Save clicked, voice script and thumbnail logged:', {
        prompt: activityInput.value,
        image: document.querySelector('#moodHistory img:last-child')?.src
      });

      // Stop blinking on Save button
      console.log('Removing blink-yellow from saveButton');
      saveButton.classList.remove('blink-yellow');
    });

    // Clear button logic
    clearButton.addEventListener('click', () => {
      activityInput.value = '';
      selectedStyle = null;
      styleSelect.value = '';
      // Reset all blinking and highlighting
      styleSelect.classList.remove('blink-yellow');
      generateImageButton.classList.remove('blink-yellow', 'highlight-yellow');
      saveButton.classList.remove('blink-yellow');
      thinkingDots.classList.remove('highlight-yellow');
      thinkingDots.style.display = 'none';
    });

    // SynthCalm Home button logic (placeholder)
    synthcalmHomeButton.addEventListener('click', () => {
      alert('Returning to SynthCalm Home...');
      // Add logic to navigate to the home page if needed
    });
  </script>
</body>
</html>
